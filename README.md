# Manufacturing Flow Animation

Interactive visualization for large-scale SimPy manufacturing simulations generated by `machine_events.csv` and `product_timeline.csv`.

The project consists of:

- **FastAPI backend** (`backend/`) that streams metadata and event slices directly from the raw CSV files using Polars for high-throughput IO.
- **PixiJS front-end** (`frontend/`) that renders up to hundreds of machines and products with WebGL acceleration, including timeline controls, buffers, and breakdown indicators.

## Features

- Adaptive event streaming window to keep memory footprint low, even for 250MB+ CSV files.
- Automatic grid layout of up to 800 machines with inter-machine transport links.
- Animated product “bubbles” that move between machine buffers and processing areas.
- Playback controls with pause, play, and speed multipliers plus manual timeline scrubbing.
- Machine inspection panel showing live queue size, last event, and breakdown state.

## Prerequisites

- Python 3.11+
- Node-free static hosting for the front-end (any HTTP server) or the `python -m http.server` module for local preview.

## Backend setup

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### Quickstart with bundled sample data

To experiment without sourcing the production CSV exports, generate the included
sample dataset and start the API against it:

```bash
python scripts/generate_sample_events.py
MACHINE_EVENTS_PATH=data/machine_events_sample.csv uvicorn backend.app.main:app --host 0.0.0.0 --port 8000
```

The sample file is a lossless conversion of the CSV excerpt shared in the
project brief, so you can immediately exercise the `/api/metadata` and
`/api/events` endpoints.

Configure the CSV locations via environment variables (absolute or relative to the repo root):

```bash
export MACHINE_EVENTS_PATH=/data/machine_events.csv
export PRODUCT_TIMELINE_PATH=/data/product_timeline.csv
# Optional: disable eager metadata load
# export SIM_PRELOAD_METADATA=false
```

Start the API server:

```bash
uvicorn backend.app.main:app --reload --host 0.0.0.0 --port 8000
```

### API endpoints

- `GET /api/metadata` – simulation duration, machine layout grid, and transport edges.
- `GET /api/events?start=0&end=5` – ordered event records within a time window (minutes).
- `GET /api/products/{entity_id}` – timeline for a single entity pulled from `product_timeline.csv`.

## Front-end setup

Serve the static files in `frontend/` from any HTTP server. When hosted on a different origin than the API, set `window.API_BASE_URL` before loading `app.js`.

```html
<script>
  window.API_BASE_URL = "http://localhost:8000";
</script>
<script src="app.js" type="module"></script>
```

For local preview while the backend runs on port 8000:

```bash
cd frontend
python -m http.server 5173
```

Then open <http://localhost:5173> in a browser.

## Performance tips

- Adjust the streaming window from the UI to balance responsiveness vs. network payload.
- Use Polars’ CSV reader options (delimiter, schema) by editing `SimulationData._scan_events` if your files have non-default formats.
- For very large datasets, consider running the backend with `SIM_PRELOAD_METADATA=false` to defer metadata computation until the first request.

## Development

- Front-end assets are framework-free ES modules; no bundler is required.
- PixiJS (WebGL) handles rendering for thousands of sprites efficiently.
- The layout generator spaces machines on a grid; integrate your own layout by replacing `_machine_layout` in `backend/app/services/data_loader.py`.
